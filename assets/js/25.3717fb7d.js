(window.webpackJsonp=window.webpackJsonp||[]).push([[25],{434:function(t,s,a){"use strict";a.r(s);var n=a(2),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"前端代码质量-圈复杂度原理和实践"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前端代码质量-圈复杂度原理和实践"}},[t._v("#")]),t._v(" 前端代码质量-圈复杂度原理和实践")]),t._v(" "),s("h2",{attrs:{id:"_1-导读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-导读"}},[t._v("#")]),t._v(" 1. 导读")]),t._v(" "),s("p",[t._v("你们是否也有过下面的想法？")]),t._v(" "),s("ul",[s("li",[t._v("重构一个项目还不如新开发一个项目...")]),t._v(" "),s("li",[t._v("这代码是谁写的，我真想...")])]),t._v(" "),s("p",[t._v("你们的项目中是否也存在下面的问题？")]),t._v(" "),s("ul",[s("li",[t._v("单个项目也越来越庞大，团队成员代码风格不一致，无法对整体的代码质量做全面的掌控")]),t._v(" "),s("li",[t._v("没有一个准确的标准去衡量代码结构复杂的程度，无法量化一个项目的代码质量")]),t._v(" "),s("li",[t._v("重构代码后无法立即量化重构后代码质量是否提升")])]),t._v(" "),s("p",[t._v("针对上面的问题，本文的主角 "),s("strong",[t._v("圈复杂度")]),t._v(" 重磅登场，本文将从圈复杂度原理出发，介绍圈复杂度的计算方法、如何降低代码的圈复杂度，如何获取圈复杂度，以及圈复杂度在公司项目的实践应用。")]),t._v(" "),s("h2",{attrs:{id:"_2-圈复杂度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-圈复杂度"}},[t._v("#")]),t._v(" 2. 圈复杂度")]),t._v(" "),s("h3",{attrs:{id:"_2-1-定义"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-定义"}},[t._v("#")]),t._v(" 2.1 定义")]),t._v(" "),s("p",[s("strong",[t._v("圈复杂度")]),t._v(" (Cyclomatic complexity) 是一种代码复杂度的衡量标准，也称为条件复杂度或循环复杂度，它可以用来衡量一个模块判定结构的复杂程度，数量上表现为独立现行路径条数，也可理解为覆盖所有的可能情况最少使用的测试用例数。简称 CC 。其符号为 VG 或是 M 。")]),t._v(" "),s("blockquote",[s("p",[s("strong",[t._v("圈复杂度")]),t._v(" 在 1976 年由 Thomas J. McCabe, Sr. 提出。")])]),t._v(" "),s("p",[t._v("圈复杂度大说明程序代码的判断逻辑复杂，可能质量低且难于测试和维护。程序的可能错误和高的圈复杂度有着很大关系。")]),t._v(" "),s("h3",{attrs:{id:"_2-2-衡量标准"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-衡量标准"}},[t._v("#")]),t._v(" 2.2 衡量标准")]),t._v(" "),s("blockquote",[s("p",[t._v("代码复杂度低，代码不一定好，但代码复杂度高，代码一定不好。")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("圈复杂度")]),t._v(" "),s("th",[t._v("代码状况")]),t._v(" "),s("th",[t._v("可测性")]),t._v(" "),s("th",[t._v("维护成本")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("1 - 10")]),t._v(" "),s("td",[t._v("清晰、结构化")]),t._v(" "),s("td",[t._v("高")]),t._v(" "),s("td",[t._v("低")])]),t._v(" "),s("tr",[s("td",[t._v("10 - 20")]),t._v(" "),s("td",[t._v("复杂")]),t._v(" "),s("td",[t._v("中")]),t._v(" "),s("td",[t._v("中")])]),t._v(" "),s("tr",[s("td",[t._v("20 - 30")]),t._v(" "),s("td",[t._v("非常复杂")]),t._v(" "),s("td",[t._v("低")]),t._v(" "),s("td",[t._v("高")])]),t._v(" "),s("tr",[s("td",[t._v(">30")]),t._v(" "),s("td",[t._v("不可读")]),t._v(" "),s("td",[t._v("不可测")]),t._v(" "),s("td",[t._v("非常高")])])])]),t._v(" "),s("h2",{attrs:{id:"_3-计算方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-计算方法"}},[t._v("#")]),t._v(" 3. 计算方法")]),t._v(" "),s("h3",{attrs:{id:"_3-1-控制流程图"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-控制流程图"}},[t._v("#")]),t._v(" 3.1 控制流程图")]),t._v(" "),s("p",[t._v("控制流程图，是一个过程或程序的抽象表现，是用在编译器中的一个抽象数据结构，由编译器在内部维护，代表了一个程序执行过程中会遍历到的所有路径。它用图的形式表示一个过程内所有基本块执行的可能流向, 也能反映一个过程的实时执行过程。\n下面是一些常见的控制流程：")]),t._v(" "),s("h3",{attrs:{id:"_3-2-节点判定法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-节点判定法"}},[t._v("#")]),t._v(" 3.2 节点判定法")]),t._v(" "),s("p",[t._v("有一个简单的计算方法，圈复杂度实际上就是等于判定节点的数量再加上1。向上面提到的："),s("code",[t._v("if else")]),t._v(" 、"),s("code",[t._v("switch case")]),t._v(" 、 "),s("code",[t._v("for")]),t._v("循环、三元运算符等等，都属于一个判定节点，例如下面的代码：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testComplexity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("param"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" i"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" Math"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("random")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("switch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("parseInt")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("case")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("30")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n            result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("上面的代码中一共有"),s("code",[t._v("1")]),t._v("个"),s("code",[t._v("if")]),t._v("语句，一个"),s("code",[t._v("for")]),t._v("循环，两个"),s("code",[t._v("case")]),t._v("语句，一个三元运算符,所以代码复杂度为 "),s("code",[t._v("1+2+1+1+1=6")]),t._v("。另外，需要注意的是 "),s("code",[t._v("|| 和 &&")]),t._v(" 语句也会被算作一个判定节点，例如下面代码的代码复杂为"),s("code",[t._v("3")]),t._v("：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("testComplexity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("param"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" result "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("param "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" param "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        result"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" result"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("h3",{attrs:{id:"_3-3-点边计算法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-点边计算法"}},[t._v("#")]),t._v(" 3.3 点边计算法")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("M")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("E")]),t._v(" − "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("N")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v(" 2P\n复制代码\n")])])]),s("ul",[s("li",[t._v("E：控制流图中边的数量")]),t._v(" "),s("li",[t._v("N：控制流图中的节点数量")]),t._v(" "),s("li",[t._v("P：独立组件的数目")])]),t._v(" "),s("p",[t._v("前两个，边和节点都是数据结构图中最基本的概念：\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284003-49a6027a-6d07-4a6c-888c-d9711e2e2488.webp#align=left&display=inline&height=289&originHeight=518&originWidth=896&search=&size=0&status=done&width=500",alt:""}}),t._v("\nP代表图中独立组件的数目，独立组件是什么意思呢？来看看下面两个图，左侧为连通图，右侧为非连通图：")]),t._v(" "),s("ul",[s("li",[t._v("连通图：对于图中任意两个顶点都是连通的")])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368283988-194a3178-53fe-4169-938a-576e40904d8b.webp#align=left&display=inline&height=277&originHeight=414&originWidth=896&search=&size=0&status=done&width=600",alt:""}}),t._v("\n一个连通图即为图中的一个独立组件，所以左侧图中独立组件的数目为1，右侧则有两个独立组件。\n对于我们的代码转化而来的控制流程图，正常情况下所有节点都应该是连通的，除非你在某些节点之前执行了 "),s("code",[t._v("return")]),t._v("，显然这样的代码是错误的。所以每个程序流程图的独立组件的数目都为1，所以上面的公式还可以简化为 "),s("code",[t._v("M = E − N + 2")]),t._v(" 。")]),t._v(" "),s("h2",{attrs:{id:"_4-降低代码的圈复杂度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-降低代码的圈复杂度"}},[t._v("#")]),t._v(" 4. 降低代码的圈复杂度")]),t._v(" "),s("p",[t._v("我们可以通过一些代码重构手段来降低代码的圈复杂度。")]),t._v(" "),s("blockquote",[s("p",[t._v("重构需谨慎，示例代码仅仅代表一种思想，实际代码要远远比示例代码复杂的多。")])]),t._v(" "),s("h3",{attrs:{id:"_4-1-抽象配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-抽象配置"}},[t._v("#")]),t._v(" 4.1 抽象配置")]),t._v(" "),s("p",[t._v("通过抽象配置将复杂的逻辑判断进行简化。例如下面的代码，根据用户的选择项执行相应的操作，重构后降低了代码复杂度，并且如果之后有新的选项，直接加入配置即可，而不需要再去深入代码逻辑中进行改动：\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471736-a63e9115-4325-4945-8005-e091cfa25f9a.webp#align=left&display=inline&height=643&originHeight=643&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-2-单一职责-提炼函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-单一职责-提炼函数"}},[t._v("#")]),t._v(" 4.2 单一职责 - 提炼函数")]),t._v(" "),s("p",[t._v("单一职责原则"),s("code",[t._v("（SRP）")]),t._v("：每个类都应该有一个单一的功能，一个类应该只有一个发生变化的原因。\n在 "),s("code",[t._v("JavaScript")]),t._v(" 中，需要用到的类的场景并不太多，单一职责原则则是更多地运用在对象或者方法级别上面。")]),t._v(" "),s("blockquote",[s("p",[t._v("函数应该做一件事，做好这件事，只做这一件事。 — 代码整洁之道")])]),t._v(" "),s("p",[t._v("关键是如何定义这 “一件事” ，如何将代码中的逻辑进行抽象，有效的提炼函数有利于降低代码复杂度和降低维护成本。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471725-8cfb4b92-a0c3-4e43-95cd-fc5fc750728f.webp#align=left&display=inline&height=675&originHeight=675&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-3-使用-break-和-return-代替控制标记"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-使用-break-和-return-代替控制标记"}},[t._v("#")]),t._v(" 4.3 使用 break 和 return 代替控制标记")]),t._v(" "),s("p",[t._v("我们经常会使用一个控制标记来标示当前程序运行到某一状态，很多场景下，使用 "),s("code",[t._v("break")]),t._v(" 和 "),s("code",[t._v("return")]),t._v(" 可以代替这些标记并降低代码复杂度。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471787-36a4648d-850a-491d-8987-0f2c5f60ee44.webp#align=left&display=inline&height=568&originHeight=568&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-4-用函数取代参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-用函数取代参数"}},[t._v("#")]),t._v(" 4.4 用函数取代参数")]),t._v(" "),s("p",[s("code",[t._v("setField")]),t._v(" 和 "),s("code",[t._v("getField")]),t._v(" 函数就是典型的函数取代参数，如果么有 "),s("code",[t._v("setField、getField")]),t._v(" 函数，我们可能需要一个很复杂的 "),s("code",[t._v("setValue、getValue")]),t._v(" 来完成属性赋值操作：\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471731-e292750d-5cfd-4cca-90f6-7e5f9e457858.webp#align=left&display=inline&height=611&originHeight=611&originWidth=1257&search=&size=0&status=done&width=1257",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-5-简化条件判断-逆向条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-5-简化条件判断-逆向条件"}},[t._v("#")]),t._v(" 4.5 简化条件判断 - 逆向条件")]),t._v(" "),s("p",[t._v("某些复杂的条件判断可能逆向思考后会变的更简单。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471783-f89b3676-76cf-497d-9912-df49f4e901c6.webp#align=left&display=inline&height=488&originHeight=488&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-6-简化条件判断-合并条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-6-简化条件判断-合并条件"}},[t._v("#")]),t._v(" 4.6 简化条件判断 -合并条件")]),t._v(" "),s("p",[t._v("将复杂冗余的条件判断进行合并。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471768-81ad6101-c6d4-4f93-b797-806f5a3259df.webp#align=left&display=inline&height=687&originHeight=687&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_4-7-简化条件判断-提取条件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-7-简化条件判断-提取条件"}},[t._v("#")]),t._v(" 4.7 简化条件判断 - 提取条件")]),t._v(" "),s("p",[t._v("将复杂难懂的条件进行语义化提取。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368471737-cb2d9e2a-d3d0-44a2-85b2-c72d2b9e05aa.webp#align=left&display=inline&height=563&originHeight=563&originWidth=1280&search=&size=0&status=done&width=1280",alt:""}}),t._v("\n作者：ConardLi\n链接：https://juejin.im/post/5da34216e51d4578502c24c5\n来源：掘金\n著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。")]),t._v(" "),s("h2",{attrs:{id:"_5-圈复杂度检测方法"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-圈复杂度检测方法"}},[t._v("#")]),t._v(" 5. 圈复杂度检测方法")]),t._v(" "),s("h3",{attrs:{id:"_5-1-eslint规则"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-eslint规则"}},[t._v("#")]),t._v(" 5.1 eslint规则")]),t._v(" "),s("p",[s("code",[t._v("eslint")]),t._v("提供了检测代码圈复杂度的"),s("code",[t._v("rules")]),t._v(":\n我们将开启 "),s("code",[t._v("rules")]),t._v(" 中的 "),s("code",[t._v("complexity")]),t._v(" 规则，并将圈复杂度大于 "),s("code",[t._v("0")]),t._v(" 的代码的 "),s("code",[t._v("rule severity")]),t._v(" 设置为 "),s("code",[t._v("warn")]),t._v(" 或 "),s("code",[t._v("error")]),t._v(" 。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("complexity")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'warn'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("max")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("这样 "),s("code",[t._v("eslint")]),t._v(" 就会自动检测出所有函数的代码复杂度，并输出一个类似下面的 "),s("code",[t._v("message")]),t._v("。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("Method "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'testFunc'")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("12.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("\nAsync "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("6.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n复制代码\n")])])]),s("h3",{attrs:{id:"_5-2-cliengine"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-cliengine"}},[t._v("#")]),t._v(" 5.2 CLIEngine")]),t._v(" "),s("p",[t._v("我们可以借助 "),s("code",[t._v("eslint")]),t._v(" 的 "),s("code",[t._v("CLIEngine")]),t._v(" ，在本地使用自定义的 "),s("code",[t._v("eslint")]),t._v(" 规则扫描代码，并获取扫描结果输出。\n初始化 "),s("code",[t._v("CLIEngine")]),t._v(" ：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" eslint "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'eslint'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" CLIEngine "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" eslint"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cli "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("CLIEngine")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("parserOptions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ecmaVersion")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2018")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("complexity")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'error'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("max")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n复制代码\n")])])]),s("p",[t._v("使用 "),s("code",[t._v("executeOnFiles")]),t._v(" 对指定文件进行扫描，并获取结果，过滤出所有 "),s("code",[t._v("complexity")]),t._v(" 的 "),s("code",[t._v("message")]),t._v(" 信息。")]),t._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("const reports = cli.executeOnFiles(['.']).results;\nfor (let i = 0; i < reports.length; i++) {\n    const { messages } = reports[i];\n    for (let j = 0; j < messages.length; j++) {\n        const { message, ruleId } = messages[j];\n        if (ruleId === 'complexity') {\n             console.log(message);\n        }\n    }\n}\n复制代码\n")])])]),s("h3",{attrs:{id:"_5-3-提取message"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-提取message"}},[t._v("#")]),t._v(" 5.3 提取message")]),t._v(" "),s("p",[t._v("通过 "),s("code",[t._v("eslint")]),t._v(" 的检测结果将有用的信息提取出来，先测试几个不同类型的函数，看看 "),s("code",[t._v("eslint")]),t._v(" 的检测结果：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("func2")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("TestClass")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("func4")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("执行结果：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("Function "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'func1'")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.")]),t._v("\nArrow "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.")]),t._v("\nMethod "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'func3'")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.")]),t._v("\nAsync "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'func4'")]),t._v(" has a complexity "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("of")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1.")]),t._v(" Maximum allowed is "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.")]),t._v("\n复制代码\n")])])]),s("p",[t._v("可以发现，除了前面的函数类型，以及后面的复杂度，其他都是相同的。\n函数类型：")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Function")]),t._v(" ：普通函数")]),t._v(" "),s("li",[s("code",[t._v("Arrow function")]),t._v(" ： 箭头函数")]),t._v(" "),s("li",[s("code",[t._v("Method")]),t._v(" ： 类方法")]),t._v(" "),s("li",[s("code",[t._v("Async function")]),t._v(" ： 异步函数")])]),t._v(" "),s("p",[t._v("截取方法类型：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REG_FUNC_TYPE")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("^(Method |Async function |Arrow function |Function )")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFunctionType")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" hasFuncType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("REG_FUNC_TYPE")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" hasFuncType "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&&")]),t._v(" RegExp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("将有用的部分提取出来：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MESSAGE_PREFIX")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'Maximum allowed is 1.'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MESSAGE_SUFFIX")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'has a complexity of '")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MESSAGE_PREFIX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("MESSAGE_SUFFIX")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("提取方法名称：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getFunctionName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" main "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("let")]),t._v(" test "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("'([a-zA-Z0-9_$]+)'")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" test "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" RegExp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$1 "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'*'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("截取代码复杂度：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getComplexity")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("message")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" main "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getMain")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("message"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("(\\d+)\\.")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-flags"}},[t._v("g")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("main"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("RegExp"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$1"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("p",[t._v("除了 "),s("code",[t._v("message")]),t._v(" ，还有其他的有用信息：")]),t._v(" "),s("ul",[s("li",[t._v("函数位置：获取 "),s("code",[t._v("messages")]),t._v(" 中的 "),s("code",[t._v("line")]),t._v(" 、"),s("code",[t._v("column")]),t._v("  即函数的行、列位置")]),t._v(" "),s("li",[t._v("当前文件名称："),s("code",[t._v("reports")]),t._v(" 结果中可以获取当前扫描文件的绝对路径 "),s("code",[t._v("filePath")]),t._v(" ，通过下面的操作获取真实文件名：")])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("filePath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("replace")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("''")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("trim")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n复制代码\n")])])]),s("ul",[s("li",[t._v("复杂度等级，根据函数的复杂度等级给出重构建议：\n| 圈复杂度 | 代码状况 | 可测性 | 维护成本 |\n| --- | --- | --- | --- |\n| 1 - 10 | 清晰、结构化 | 高 | 低 |\n| 10 - 20 | 复杂 | 中 | 中 |\n| 20 - 30 | 非常复杂 | 低 | 高 |\n| >30 | 不可读 | 不可测 | 非常高 |")])]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("圈复杂度")]),t._v(" "),s("th",[t._v("代码状况")])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("1 - 10")]),t._v(" "),s("td",[t._v("无需重构")])]),t._v(" "),s("tr",[s("td",[t._v("11 - 15")]),t._v(" "),s("td",[t._v("建议重构")])]),t._v(" "),s("tr",[s("td",[t._v(">15")]),t._v(" "),s("td",[t._v("强烈建议重构")])])])]),t._v(" "),s("h2",{attrs:{id:"_6-架构设计"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_6-架构设计"}},[t._v("#")]),t._v(" 6.架构设计")]),t._v(" "),s("p",[t._v("将代码复杂度检测封装成基础包，根据自定义配置输出检测数据，供其他应用调用。\n上面的展示了使用 "),s("code",[t._v("eslint")]),t._v(" 获取代码复杂度的思路，下面我们要把它封装为一个通用的工具，考虑到工具可能在不同场景下使用，例如：网页版的分析报告、cli版的命令行工具，我们把通用的能力抽象出来以 "),s("code",[t._v("npm包")]),t._v(" 的形式供其他应用使用。\n在计算项目代码复杂度之前，我们首先要具备一项基础能力，代码扫描，即我们要知道我们要对项目里的哪些文件做分析，首先 "),s("code",[t._v("eslint")]),t._v(" 是具备这样的能力的，我们也可以直接用 "),s("code",[t._v("glob")]),t._v(" 来遍历文件。但是他们都有一个缺点，就是 "),s("code",[t._v("ignore")]),t._v(" 规则是不同的，这对于用户来讲是有一定学习成本的，因此我这里把手动封装代码扫描，使用通用的 "),s("code",[t._v("npm ignore")]),t._v(" 规则，这样代码扫描就可以直接使用 "),s("code",[t._v(".gitignore")]),t._v("这样的配置文件。另外，代码扫描作为代码分析的基础能力，其他代码分析也是可以公用的。")]),t._v(" "),s("ul",[s("li",[t._v("基础能力\n"),s("ul",[s("li",[t._v("代码扫描能力")]),t._v(" "),s("li",[t._v("复杂度检测能力")]),t._v(" "),s("li",[t._v("...")])])]),t._v(" "),s("li",[t._v("应用\n"),s("ul",[s("li",[t._v("命令行工具")]),t._v(" "),s("li",[t._v("代码分析报告")]),t._v(" "),s("li",[t._v("...")])])])]),t._v(" "),s("h2",{attrs:{id:"_7-基础能力-代码扫描"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-基础能力-代码扫描"}},[t._v("#")]),t._v(" 7. 基础能力 - 代码扫描")]),t._v(" "),s("p",[t._v("本文涉及的 "),s("code",[t._v("npm")]),t._v(" 包和 "),s("code",[t._v("cli")]),t._v("命令源码均可在我的开源项目 "),s("a",{attrs:{href:"https://github.com/ConardLi/awesome-cli",target:"_blank",rel:"noopener noreferrer"}},[t._v("awesome-cli"),s("OutboundLink")],1),t._v("中查看。")]),t._v(" "),s("blockquote",[s("p",[t._v("awesome-cli 是我新建的一个开源项目：有趣又实用的命令行工具，后面会持续维护，敬请关注，欢迎 star。")])]),t._v(" "),s("p",[t._v("代码扫描（"),s("code",[t._v("c-scan")]),t._v("）源码："),s("a",{attrs:{href:"https://github.com/ConardLi/awesome-cli/tree/master/conard",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/ConardLi/aw…"),s("OutboundLink")],1),t._v("\n代码扫描是代码分析的底层能力，它主要帮助我们拿到我们想要的文件路径，应该满足我们以下两个需求：")]),t._v(" "),s("ul",[s("li",[t._v("我要得到什么类型的文件")]),t._v(" "),s("li",[t._v("我不想要哪些文件")])]),t._v(" "),s("h3",{attrs:{id:"_7-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-1-使用"}},[t._v("#")]),t._v(" 7.1 使用")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("npm i c"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("scan "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" scan "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c-scan'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("scan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("extensions")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'**/*.js'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rootPath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'src'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("defalutIgnore")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'true'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignoreRules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignoreFileName")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'.gitignore'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n复制代码\n")])])]),s("h3",{attrs:{id:"_7-2-返回值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-2-返回值"}},[t._v("#")]),t._v(" 7.2 返回值")]),t._v(" "),s("p",[t._v("符合规则的文件路径数组：")]),t._v(" "),s("h3",{attrs:{id:"_7-3-参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-3-参数"}},[t._v("#")]),t._v(" 7.3 参数")]),t._v(" "),s("ul",[s("li",[s("strong",[t._v("extensions")]),t._v(" "),s("ul",[s("li",[t._v("扫描文件扩展名")]),t._v(" "),s("li",[t._v("默认值："),s("code",[t._v("**/*.js")])])])]),t._v(" "),s("li",[s("strong",[t._v("rootPath")]),t._v(" "),s("ul",[s("li",[t._v("扫描文件路径")]),t._v(" "),s("li",[t._v("默认值："),s("code",[t._v(".")])])])]),t._v(" "),s("li",[s("strong",[t._v("defalutIgnore")]),t._v(" "),s("ul",[s("li",[t._v("是否开启默认忽略（"),s("code",[t._v("glob")]),t._v("规则）")]),t._v(" "),s("li",[s("code",[t._v("glob ignore")]),t._v("规则为内部使用，为了统一"),s("code",[t._v("ignore")]),t._v("规则，自定义规则使用"),s("code",[t._v("gitignore")]),t._v("规则")]),t._v(" "),s("li",[t._v("默认值："),s("code",[t._v("true")])]),t._v(" "),s("li",[t._v("默认开启的 "),s("code",[t._v("glob ignore")]),t._v(" 规则：")])])])]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT_IGNORE_PATTERNS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node_modules/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'build/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'dist/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'output/**'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'common_build/**'")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n复制代码\n")])])]),s("ul",[s("li",[s("strong",[t._v("ignoreRules")]),t._v(" "),s("ul",[s("li",[t._v("自定义忽略规则（"),s("code",[t._v("gitignore")]),t._v("规则）")]),t._v(" "),s("li",[t._v("默认值："),s("code",[t._v("[]")])])])]),t._v(" "),s("li",[s("strong",[t._v("ignoreFileName")]),t._v(" "),s("ul",[s("li",[t._v("自定义忽略规则配置文件路径（"),s("code",[t._v("gitignore")]),t._v("规则）")]),t._v(" "),s("li",[t._v("默认值："),s("code",[t._v(".gitignore")])]),t._v(" "),s("li",[t._v("指定为"),s("code",[t._v("null")]),t._v("则不启用"),s("code",[t._v("ignore")]),t._v("配置文件")])])])]),t._v(" "),s("h3",{attrs:{id:"_7-4-核心实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_7-4-核心实现"}},[t._v("#")]),t._v(" 7.4 核心实现")]),t._v(" "),s("p",[t._v("基于 "),s("code",[t._v("glob")]),t._v(" ，自定义 "),s("code",[t._v("ignore")]),t._v(" 规则进行二次封装。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 获取glob扫描的文件列表\n * @param {*} rootPath 跟路径\n * @param {*} extensions 扩展\n * @param {*} defalutIgnore 是否开启默认忽略\n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getGlobScan")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("rootPath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" extensions"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" defalutIgnore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("glob")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token template-string"}},[s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("rootPath"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token interpolation"}},[s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("${")]),t._v("extensions"),s("span",{pre:!0,attrs:{class:"token interpolation-punctuation punctuation"}},[t._v("}")])]),s("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[t._v("`")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("dot")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("ignore")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" defalutIgnore "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEFAULT_IGNORE_PATTERNS")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" files")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                    console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("err"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                    process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("exit")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 加载ignore配置文件，并处理成数组\n * @param {*} ignoreFileName \n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("async")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("loadIgnorePatterns")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("ignoreFileName")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ignorePath "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ignoreFileName"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ignores "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" fs"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("readFileSync")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ignorePath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'utf8'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" ignores"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("split")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("[\\n\\r]|\\n\\r")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("pattern")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("Boolean")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("pattern"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("e"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n * 根据ignore配置过滤文件列表\n * @param {*} files \n * @param {*} ignorePatterns \n * @param {*} cwd \n */")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filterFilesByIgnore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("files"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ignorePatterns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" ignoreRules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cwd "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" process"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cwd")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" ig "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ignore")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("ignorePatterns"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("ignoreRules"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" filtered "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" files\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("raw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("isAbsolute")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("raw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("?")]),t._v(" raw "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cwd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" raw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("raw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("relative")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cwd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" raw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("filter")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("filePath")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("ig"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("ignores")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("filePath"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("map")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("raw")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" path"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("cwd"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" raw"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" filtered"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n复制代码\n")])])]),s("h2",{attrs:{id:"_8-基础能力-代码复杂度检测"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-基础能力-代码复杂度检测"}},[t._v("#")]),t._v(" 8. 基础能力 - 代码复杂度检测")]),t._v(" "),s("p",[t._v("代码复杂度检测（"),s("code",[t._v("c-complexity")]),t._v("）源码："),s("a",{attrs:{href:"https://github.com/ConardLi/awesome-cli/tree/master/code-complexity",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/ConardLi/aw…"),s("OutboundLink")],1),t._v("\n代码检测基础包应该具备以下几个能力：")]),t._v(" "),s("ul",[s("li",[t._v("自定义扫描文件夹和类型")]),t._v(" "),s("li",[t._v("支持忽略文件")]),t._v(" "),s("li",[t._v("定义最小提醒代码复杂度")])]),t._v(" "),s("h3",{attrs:{id:"_8-1-使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-1-使用"}},[t._v("#")]),t._v(" 8.1 使用")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("npm i c"),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("complexity "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("--")]),t._v("save\n"),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" cc "),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'c-complexity'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("cc")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n复制代码\n")])])]),s("h3",{attrs:{id:"_8-2-返回值"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-2-返回值"}},[t._v("#")]),t._v(" 8.2 返回值")]),t._v(" "),s("ul",[s("li",[t._v("fileCount：文件数量")]),t._v(" "),s("li",[t._v("funcCount：函数数量")]),t._v(" "),s("li",[t._v("result：详细结果\n"),s("ul",[s("li",[t._v("funcType：函数类型")]),t._v(" "),s("li",[t._v("funcName；函数名称")]),t._v(" "),s("li",[t._v("position：详细位置（行列号）")]),t._v(" "),s("li",[t._v("fileName：文件相对路径")]),t._v(" "),s("li",[t._v("complexity：代码复杂度")]),t._v(" "),s("li",[t._v("advice：重构建议")])])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368283992-cfb7c760-ef78-482c-9a48-2c844dbc8548.webp#align=left&display=inline&height=454&originHeight=646&originWidth=854&search=&size=0&status=done&width=600",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_8-3-参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_8-3-参数"}},[t._v("#")]),t._v(" 8.3 参数")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("scanParam")]),t._v(" "),s("ul",[s("li",[t._v("继承自上面代码扫描的参数")])])]),t._v(" "),s("li",[s("code",[t._v("min")]),t._v(" "),s("ul",[s("li",[t._v("最小提醒代码复杂度，默认为1")])])])]),t._v(" "),s("h2",{attrs:{id:"_9-应用-代码复杂度检测工具"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-应用-代码复杂度检测工具"}},[t._v("#")]),t._v(" 9. 应用 - 代码复杂度检测工具")]),t._v(" "),s("p",[t._v("代码复杂度检测（"),s("code",[t._v("conard cc")]),t._v("）源码："),s("a",{attrs:{href:"https://github.com/ConardLi/awesome-cli/blob/master/conard/",target:"_blank",rel:"noopener noreferrer"}},[t._v("github.com/ConardLi/aw…"),s("OutboundLink")],1),t._v(" "),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284000-567aaf56-6ac8-435b-a111-43ec4be99b51.webp#align=left&display=inline&height=328&originHeight=525&originWidth=1280&search=&size=0&status=done&width=800",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"_9-1-指定最小提醒复杂度"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-1-指定最小提醒复杂度"}},[t._v("#")]),t._v(" 9.1 指定最小提醒复杂度")]),t._v(" "),s("p",[t._v("可以触发提醒的最小复杂度。")]),t._v(" "),s("ul",[s("li",[t._v("默认为 "),s("code",[t._v("10")])]),t._v(" "),s("li",[t._v("通过命令 "),s("code",[t._v("conard cc --min=5")]),t._v(" 自定义")])]),t._v(" "),s("h3",{attrs:{id:"_9-2-指定扫描参数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_9-2-指定扫描参数"}},[t._v("#")]),t._v(" 9.2 指定扫描参数")]),t._v(" "),s("p",[t._v("自定义扫描规则")]),t._v(" "),s("ul",[s("li",[t._v("扫描参数继承自上面的 "),s("code",[t._v("scan param")])]),t._v(" "),s("li",[t._v("例如： "),s("code",[t._v("conard cc --defalutIgnore=false")])])]),t._v(" "),s("h2",{attrs:{id:"_10-应用-代码复杂度报告"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_10-应用-代码复杂度报告"}},[t._v("#")]),t._v(" 10. 应用 - 代码复杂度报告")]),t._v(" "),s("blockquote",[s("p",[t._v("部分截图来源于我们内部的项目质量监控平台，圈复杂度作为一项重要的指标，对于衡量项目代码质量起着至关重要的作用。")])]),t._v(" "),s("h3",{attrs:{id:"代码复杂复杂度变化趋势"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码复杂复杂度变化趋势"}},[t._v("#")]),t._v(" 代码复杂复杂度变化趋势")]),t._v(" "),s("p",[t._v("定时任务爬取代码每日的代码复杂度、代码行数、函数个数，通过每日数据绘制代码复杂度和代码行数变化趋势折线图。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284019-65c06570-0766-49e0-b350-2177124bea98.webp#align=left&display=inline&height=161&originHeight=553&originWidth=1200&search=&size=0&status=done&width=350",alt:""}}),t._v(" "),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284036-a4c9035a-c6e0-4976-a9c8-3900efdb13ea.webp#align=left&display=inline&height=159&originHeight=545&originWidth=1200&search=&size=0&status=done&width=350",alt:""}}),t._v("\n通过 [ 复杂度 / 代码行数 ] 或 [ 复杂度 / 函数个数 ] 的变化趋势，判断项目发展是否健康。")]),t._v(" "),s("ul",[s("li",[s("p",[t._v("比值若一直在上涨，说明你的代码在变得越来越难以理解。这不仅使我们面临意外的功能交互和缺陷的风险，由于我们在具有或多或少相关功能的模块中所面临的过多认知负担，也很难重用代码并进行修改和测试。（下图1）")])]),t._v(" "),s("li",[s("p",[t._v("若比值在某个阶段发生突变，说明这段期间迭代质量很差。（下图2）")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284015-a2bb98d4-8deb-444e-8e30-6c3b49c65921.webp#align=left&display=inline&height=387&originHeight=580&originWidth=1200&search=&size=0&status=done&width=800",alt:""}})]),t._v(" "),s("ul",[s("li",[s("p",[t._v("复杂度曲线图可以很快的帮你更早的发现上面这两个问题，发现它们后，你可能需要重构代码。复杂性趋势对于跟踪你的代码重构也很有用。复杂性趋势的下降趋势是一个好兆头。这要么意味着您的代码变得更简单（例如，把 if-else 被重构为多态解决方案），要么代码更少（将不相关的部分提取到了其他模块中）。（下图3）")])]),t._v(" "),s("li",[s("p",[t._v("代码重构后，你还需要继续探索复杂度变化趋势。经常发生的事情是，我们花费大量的时间和精力来重构，无法解决根本原因，很快复杂度又滑回了原处。（下图4）你可能觉得这是个例，但是有研究标明，在分析了数百个代码库后，发现出现这种情况的频率很高。因此，时刻观察代码复杂度变化趋势是有必要的。")])])]),t._v(" "),s("p",[s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284149-847c661c-2c8c-401d-83cb-3f4396d544e5.webp#align=left&display=inline&height=397&originHeight=595&originWidth=1200&search=&size=0&status=done&width=800",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"代码复杂度文件分布"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码复杂度文件分布"}},[t._v("#")]),t._v(" 代码复杂度文件分布")]),t._v(" "),s("p",[t._v("统计各复杂度分布的函数数量。\n"),s("img",{attrs:{src:"https://cdn.nlark.com/yuque/0/2019/webp/119800/1571368284004-37ffb994-b5fe-4a09-aed4-9de99f09d294.webp#align=left&display=inline&height=281&originHeight=281&originWidth=1200&search=&size=0&status=done&width=1200",alt:""}})]),t._v(" "),s("h3",{attrs:{id:"代码复杂度文件详情"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码复杂度文件详情"}},[t._v("#")]),t._v(" 代码复杂度文件详情")]),t._v(" "),s("p",[t._v("计算每个函数的代码复杂度，从高到低依次列出高复杂度的文件分布，并给出重构建议。")]),t._v(" "),s("h2",{attrs:{id:"使用方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用方式"}},[t._v("#")]),t._v(" 使用方式：")]),t._v(" "),s("h3",{attrs:{id:"_1-eslint使用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-eslint使用"}},[t._v("#")]),t._v(" 1.eslint使用")]),t._v(" "),s("p",[t._v("在eslint.js文件中增加：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"complexity"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n                "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"max"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v("'max-lines'")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"error"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"max"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("400")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"skipBlankLines"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n            "),s("span",{pre:!0,attrs:{class:"token string-property property"}},[t._v('"skipComments"')]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),s("h3",{attrs:{id:"_2-使用webpack-loader"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-使用webpack-loader"}},[t._v("#")]),t._v(" 2. 使用webpack loader")]),t._v(" "),s("p",[s("a",{attrs:{href:"https://github.com/hellosean1025/code-metrics-loader",target:"_blank",rel:"noopener noreferrer"}},[t._v("code-metrics-loader"),s("OutboundLink")],1)]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("module")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("rules")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("enforce")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'pre'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("test")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("\\.js$")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("exclude")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token regex"}},[s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")]),s("span",{pre:!0,attrs:{class:"token regex-source language-regex"}},[t._v("node_modules")]),s("span",{pre:!0,attrs:{class:"token regex-delimiter"}},[t._v("/")])]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("use")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("loader")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'code-metrics-loader'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("options")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n          "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("errorLimit")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("20")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n  "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),s("blockquote",[s("p",[t._v("实际开发中并不一定所有的代码都需要被分析，例如打包产物、静态资源文件等等，这些文件往往会误导我们的分析结果，现在分析工具会默认忽略一些规则，例如：.gitignore文件、static目录等等，实际这些规则还需要根据实际项目的情况去不断完善，使分析结果变得更准确。")])]),t._v(" "),s("h2",{attrs:{id:"参考"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[t._v("#")]),t._v(" 参考")]),t._v(" "),s("ul",[s("li",[s("a",{attrs:{href:"https://mp.weixin.qq.com/s/3D1gQAHZu3Rx_kLQmUQGzg",target:"_blank",rel:"noopener noreferrer"}},[t._v("加推研发质量与规范实战"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://codescene.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("codescene"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://juejin.im/post/5adf1dfe5188256715474ca3",target:"_blank",rel:"noopener noreferrer"}},[t._v("圈复杂度那些事儿-前端代码质量系列文章（二）"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://juejin.im/post/59bb8b546fb9a00a4247532e",target:"_blank",rel:"noopener noreferrer"}},[t._v("代码质量管控 -- 复杂度检测"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"http://kaelzhang81.github.io/2017/06/18/%E8%AF%A6%E8%A7%A3%E5%9C%88%E5%A4%8D%E6%9D%82%E5%BA%A6/",target:"_blank",rel:"noopener noreferrer"}},[t._v("详解圈复杂度"),s("OutboundLink")],1)]),t._v(" "),s("li",[s("a",{attrs:{href:"https://juejin.im/post/5da34216e51d4578502c24c5",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://juejin.im/post/5da34216e51d4578502c24c5"),s("OutboundLink")],1)])]),t._v(" "),s("h2",{attrs:{id:"小结"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#小结"}},[t._v("#")]),t._v(" 小结")]),t._v(" "),s("p",[t._v("希望看完本篇文章能对你有如下帮助：")]),t._v(" "),s("ul",[s("li",[t._v("理解圈复杂度的意义和计算方法")]),t._v(" "),s("li",[t._v("在项目中能实际应用圈复杂度提升项目质量")])])])}),[],!1,null,null,null);s.default=e.exports}}]);